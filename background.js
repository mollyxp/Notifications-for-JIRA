!function(){function e(e){var t=/^(http(?:s)?\:\/\/[a-zA-Z0-9]+(?:(?:\.|\-)[a-zA-Z0-9]+)+(?:\:\d+)?(?:\/[\w\-]+)*(?:\/?|\/\w+\.[a-zA-Z]{2,4}(?:\?[\w]+\=[\w\-]+)?)?(?:\&[\w]+\=[\w\-]+)*)$/;return t.test(e)}function t(e,t,n){var o=null,s=new XMLHttpRequest;s.open("GET",e,!0),s.onreadystatechange=function(){4===s.readyState&&(200!=s.status?(console.warn(s.status+": "+s.statusText),n&&"function"==typeof n&&n(s)):t&&"function"==typeof t&&(o=JSON.parse(s.responseText),t(o)))},s.send()}function n(t){return e(t)}function o(e,n){t(k+L+"serverInfo",function(t){t.baseUrl&&t.buildNumber&&t.version?e():n()},n)}function s(e,n){t(k+L+"myself",function(t){t.name&&t.active===!0?e():n()},n)}function i(e,t){n(k)?o(function(){s(e,t)},t):t()}function c(e){h.sync.get(null,function(t){console.log("storage.sync.get",t),e&&"function"==typeof e&&e(t)})}function r(e){e.url?k=e.url:(k=null,d(),p.openOptionsPage(),console.warn("error: url option does not exist"))}function u(){t(k+L+"search"+x.join(""),function(e){e&&e.issues&&(console.log("checkUpdates",e),a(e.issues))},d)}function a(e){var t=null;e&&0!==e.length&&(1==e.length?(t=Object.assign({},B,{title:"Issue "+e[0].key,message:e[0].fields.summary,contextMessage:"Status: "+e[0].fields.status.name,buttons:[{title:"View this issue in browser"}]}),y.create(t,function(t){var n=k+"/browse/"+e[0].key,o=function(e,s){e===t&&0===s&&b.create({url:n}),y.onButtonClicked.removeListener(o),y.clear(t)};y.onButtonClicked.addListener(o)})):(t=Object.assign({},B,{type:"list",items:e.map(function(e){return{title:"["+e.key+"] "+e.fields.summary,message:"Status: "+e.fields.status.name}}),contextMessage:e.length>5?"and "+(e.length-5)+" more issue(s)":"Total "+e.length+" issues",buttons:[{title:"View all issues in browser"}]}),y.create(t,function(e){var t=k+"/issues/?jql="+x[2],n=function(o,s){o===e&&0===s&&b.create({url:t}),y.onButtonClicked.removeListener(n),y.clear(e)};y.onButtonClicked.addListener(n)})))}function l(e){w.setBadgeText({text:e.text}),w.setBadgeBackgroundColor({color:e.color})}function f(){l(O.ON),v=setInterval(function(){u()},6e4*C),console.log("startListening")}function d(){l(O.OFF),clearInterval(v),v=null,console.log("stopListening")}function g(){console.log("browserAction.onClicked"),null===v&&null!==k?i(f,d):d()}function m(){h.onChanged.addListener(function(){console.log("storage.onChanged"),c(r)}),w.onClicked.addListener(g),d(),c(r)}var p=chrome.runtime,h=chrome.storage,w=chrome.browserAction,y=chrome.notifications,b=chrome.tabs,v=null,k=null,C=5,L="/rest/api/latest/",x=["?","jql=",encodeURIComponent("updated > -"+C+"m"),"&fields=priority,project,status,summary"],O={ON:{text:"on",color:"#009900"},OFF:{text:"off",color:"#cc0000"}},B={type:"basic",iconUrl:"icons/icon128-bg-white.png",title:"Updated issues in JIRAÂ®",message:"Updated issues"};document.addEventListener("DOMContentLoaded",m)}();